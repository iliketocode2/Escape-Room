<!DOCTYPE html>
<html>
<head>
  <title>Room 3, Floor 1</title>
  <style>
  @font-face {
        font-family: "UwU";
        src: url("Images/Seagram\ tfb.ttf");
  }
  * {
    font-family: UwU;
  }
  body {
    height: 100%;
    margin: 0;
    text-align: center;
  }
  .back{
    background-image: url("Images/cell.jpg");
    height: 100%;
  
    /* Center and scale the image*/
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
  }
  .console {
    width: 99%;
    height: 250px;
    background: skyblue;
    text-align: left;
    padding: 10px;
  }
  .itembar {
    width: 98%;
    height: 100px;
    border: 3px solid blue;
    border-radius: 5px;
    background: lightblue;
    margin-left: 10px;
    margin-right: 10px;
    display: flex;
    flex-wrap: wrap;
  }
  .itemslot {
    width: 75px;
    height: 75px;
    background: white;
    background-position: center;
    background-size: cover;
    padding: 5px;
    margin: 10px;
  }

  .hidden {
    visibility: hidden;
  }
  .arrow-left {
    width: 0;
    height: 0;
    border-top: 30px solid transparent;
    border-bottom: 30px solid transparent;
    
    border-right:30px solid green;
  }
  .arrow-left:hover {
    border-right: 30px solid lightgreen;
  }
  .arrow-down {
    width: 0;
    height: 0;
    border-left: 40px solid transparent;
    border-right:; 40px solid transparent;
    
    border-bottom:40px solid green;
  }
  .arrow-down:hover {
    border-bottom: 40px solid lightgreen;
  }
  .rec{
    width: 450px;
    height: 200px;
    border: 3px solid black;
    border-radius: 5px;
    background: gray;
    margin-left: 10px;
    margin-right: 10px;
    display: flex;
    flex-wrap: wrap;
  }
  .bar{
    background: black;
    width:-10px;
    height:160px;
    padding:15px;
    display: flex;
    flex-wrap: wrap;
    margin-left: 50px;
    margin-right: 50px;
    margin-top:5px;
  }
  .smallrec{
    background: lightgray;
    width:50px;
    height:5px;
    padding:15px;
    border: 2px solid black;
    border-radius: 5px;
    display: flex;
    flex-wrap: wrap;
    margin-left:-108px;
  }
  .hidden {
    visibility: hidden;
  }
	  
  </style>
</head>
<body>
  <div class="back">
    
    <div class="rec" id="puzzl" style="position: relative; left:40%;">
      <div class="bar"></div>
      <div class="smallrec" id="bar0"></div>
      <div class="bar" ></div>
      <div class="smallrec" id="bar1"></div>
      <div class="bar"></div>
      <div class="smallrec"  id="bar2"></div>
      <div class="bar" ></div>
      <div class="smallrec" id="bar3"></div>
    </div>
    
    <img src="Images/window.png" onclick="speak()" alt="dungeon window" style="height:200px;width:200px;position:relative;top:0%;left:15%;">
    
    <img src="Images/window.png" onclick="speak()" alt="dungeon window" style="height:200px;width:200px; position:relative;top:0%;left:35%;">
	  
	  <img src="Images/blindingdoor.png" id="opendoor" alt="door" style="height:400px;width:350px;position:relative;left:-30%;top:100px;">
	  
	  <img src="Images/closedcloset.png" onclick="showLock()" id="closet" alt="wardrobe" style="height:300px;width:200px;position:relative;left:-18%;top:100px;" class="">
	  
	  <img src="Images/bettersign.png" onclick="tell()" id="sign" alt="sign" style="height:200px;width:200px;position:relative;left:5%;top:100px;">
	  
    <img src="Images/betterclosedtrapdoor.png" id="trapdoor" alt="door" onclick="openIt()" style="height:300px;width:300px;position:relative;left:5%;top:100px;">
    
    <div class="arrow-left" id="arrow" onclick="moveLeft()" style="position:relative;left:10%;top:-100px;display:block;"></div>
    <div class="arrow-down" id="arrowD" onclick="moveDown()" style="position:relative;left:80%;top:-140px;display:block;"></div>

    <div class="trophy table" style="position:relative;top:-150px;left:15%;">
      <img src="Images/trophy.png" id="trophy" alt="trophy" style="height:100px;width:100px;position:relative;left:-5%;top:25px;" class="">
      <img src="Images/table.png" onclick="tell2()" id="table" alt="table" style="height:100px;width:200px;position:relative;top:100px;left:-15%;" class="">
	  </div>
	  
  </div>
  
  <div class="console">
    <h3 id="info">Goal:</h3>
    <p>Items you have collected will appear below:</p>
    <div class="itembar" id="invbar">
      <!--<div class="itemslot" id="0">-->
    </div>
  </div>

  <script>
    
    var activeItem = null;

    var active = false;

    arrayOfThings = [0,0,0,0]
    wiggleroom = 20

    document.getElementById("bar0").addEventListener("mousedown", dragStart, false);
    document.getElementById("bar0").addEventListener("mouseup", dragEnd, false);
    document.getElementById("bar0").addEventListener("mousemove", drag, false);

    document.getElementById("bar1").addEventListener("mouseup", dragEnd, false);
    document.getElementById("bar1").addEventListener("mousedown", dragStart, false);
    document.getElementById("bar1").addEventListener("mousemove", drag, false);

    document.getElementById("bar2").addEventListener("mousedown", dragStart, false);
    document.getElementById("bar2").addEventListener("mouseup", dragEnd, false);
    document.getElementById("bar2").addEventListener("mousemove", drag, false);

    document.getElementById("bar3").addEventListener("mousedown", dragStart, false);
    document.getElementById("bar3").addEventListener("mouseup", dragEnd, false);
    document.getElementById("bar3").addEventListener("mousemove", drag, false);




    function dragStart(e) {
        active = true;

        // this is the item we are interacting with
        activeItem = e.target;

        if (activeItem !== null) {
          if (!activeItem.xOffset) {
            activeItem.xOffset = 0;
          }

          if (!activeItem.yOffset) {
            activeItem.yOffset = 0;
          }

            console.log("doing something!");
            activeItem.initialX = e.clientX - activeItem.xOffset;
            activeItem.initialY = e.clientY - activeItem.yOffset;
          
        }
      
    }

    function dragEnd(e) {
      if (activeItem !== null) {
        activeItem.initialX = activeItem.currentX;
        activeItem.initialY = activeItem.currentY;
      }

      active = false;
      activeItem = null;
    }

    approxeq = (v1, v2, epsilon = 0.001) => Math.abs(v1 - v2) <= epsilon;


    function drag(e) {
      if (active) {
          activeItem.currentX = e.clientX - activeItem.initialX;
          activeItem.currentY = e.clientY - activeItem.initialY;
          e.preventDefault();

        activeItem.xOffset = activeItem.currentX;
        activeItem.yOffset = activeItem.currentY;

        if (activeItem.currentY <= 0) {
          activeItem.currentY = 0
        }
        if (activeItem.currentY >= 160) {
          activeItem.currentY = 160
        }

        arrayOfThings[parseInt(e.srcElement.id.split("bar")[1])] = activeItem.currentY;

        if (approxeq(arrayOfThings[0],70,wiggleroom) && approxeq(arrayOfThings[1],0,wiggleroom) && approxeq(arrayOfThings[2],160,wiggleroom) && approxeq(arrayOfThings[3],100,wiggleroom)) {
          console.log("AAAAAAAAAAAAAAAAAAAAAAAAAA")
          grabItem("Images/goldenmanshook.png")
          document.getElementById("puzzl").classList.toggle("hidden")
	  document.getElementById("closet").src = "Images/opencloset.png";
        }

        setTranslate(activeItem.currentX, activeItem.currentY, activeItem);
      }
    }

    function setTranslate(xPos, yPos, el) {
      el.style.transform = "translate3d(" + 0 + "px, " + yPos + "px, 0)";
    }

	function tell(){
	   text = "This old sign has the word 'knight' on it...";
	}
	function tell2(){
	   text = "There's nothing special about this table.";
	}
  	function showLock(){
	   text = "There's a lock with four sliders on this wardrobe.";
	}
	  
    function moveLeft() {
      window.location.href = "R2F1.html";
    }
    function moveDown() {
      window.location.href = "R3F2.html";
    }
  
    // https://www.dafont.com/seagram-tfb.font
    // Do DaFont lets gooooooooooooooo
    window.onload = function() {
      document.getElementById("arrowD").style.display = "none";
      loadInv();
    };

    inventory = []
    invObj = document.getElementById("invbar")
    document.getElementById("trophy").addEventListener("click", giveWoodenCircle)

    function loadInv() {
      inventory = JSON.parse(localStorage.getItem('inv'))
      inventory.forEach(function(a) {
        slot = document.createElement("div")
        slot.classList.toggle("itemslot")
        slot.style.backgroundImage = `url('${a}')`
        slot.id = a
        invObj.appendChild(slot)
        localStorage.setItem('inv', JSON.stringify(inventory));
      });

    }

    function clear() {
      localStorage.setItem('inv', []);
      loadInv()
    }

    function clickGrab(e) {
      item = e.srcElement.getAttribute("src")
      e.srcElement.classList.toggle("hidden")
      grabItem(item)
    }

    function nameItem(item) {
      name = item.match(/(?<=\/).*/g)
      a = name.match(/(.*)\.[^.]+$/)
	    return a[1]
    }
    
    function grabItem(item) {
      if (!inventory.includes(item)) {
        inventory.push(item)
        //document.getElementById(inventory.indexOf(item).toString()).style.backgroundImage = `url('${item}')`
        //localStorage.setItem('inv', JSON.stringify(inventory));
        slot = document.createElement("div")
        slot.classList.toggle("itemslot")
        slot.style.backgroundImage = `url('${item}')`
        slot.id = item
        invObj.appendChild(slot)
        localStorage.setItem('inv', JSON.stringify(inventory));
      }
      text = "You found the " + nameItem(item) + ".";
    }

    function consume(name) {
      try {
        if (inventory.includes(name)) {
          inventory = inventory.filter(i => i !== name)
          invObj.removeChild(document.getElementById(name))
          localStorage.setItem('inv', JSON.stringify(inventory));
          return true
        }
        return false
      } catch (error) {
        console.log(error)
        return false
      }
      return false
    }
    
    function giveWoodenCircle() {
      grabItem("Images/circle.png")
    }
    
	  
  function openIt(){
    if (inventory.includes("Images/goldenmanshook.png") && inventory.includes("Images/rope.png")) {
    var variable = document.getElementById("trapdoor");
    variable.src = "Images/betteropentrapdoor.png";
    text = "You have opened the trapdoor.";
    document.getElementById("arrowD").style.display = "block";
    }
  }
	  
   //console messgaes
    function speak(){
      text = "You aren't strong enough to break the rusty window bars.";
    }

    var text = "This room seems to be the last one on this floor.";
   
    var time = setInterval(displayMessage, 10);
   
    function displayMessage() {
      document.getElementById('info').innerHTML = text;
    }
    function play() {
    var audio = new Audio('Music/R3F1Music.mp3');
    audio.play();
  }
  document.addEventListener("click", play)

  </script>
</body>
</html>
